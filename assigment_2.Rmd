---
title: 'ASSIGNMENT 2: Vote choice in Germany'
author: "Jordi Espasa & Eduard Masip"
date: "2022-11-10"
output:
  word_document: default
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: 90
---

```{r, include=FALSE, echo=FALSE}
# Load Required Packages: to be increased over the course "ggmap""plotly""xlsx""kableExtra",
options(contrasts=c("contr.treatment","contr.treatment"))
requiredPackages <- c("missMDA","effects","FactoMineR","car",
                      "factoextra","RColorBrewer","ggplot2",
                      "dplyr","ggthemes","knitr","MASS",
                      "chemometrics","rpart","ROCR","corrr",
                      "readxl","RColorBrewer","ggplot2","PerformanceAnalytics",                           "corrplot","reshape2","scales","stargazer",
                      "cowplot","rapportools", "packHV", "chemometrics","lmtest",
                      "AER","nnet","MNLpred")


package.check <- lapply(requiredPackages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
    library(x, character.only = TRUE)
  }
})

search()  #verify they are loaded

```

# 0 - Data Descrption

Vote - Voting decision for party into 6 levels (represented parties in the Bundestag):

-   "AfD"- Alternative für Deutschland, right wing populist party (right)
-   "CDU/CSU" -- Center-right Christian-democratic political alliance (center)
-   "FDP" -- Free democratic party -- liberal party centre or centre-right of the
    political spectrum (center)
-   "Gruene" - Die Grünen -- "the Greens" (left)
-   "LINKE" - DIE LINKE the left party is a democratic socialist political party in
    Germany, it is the furthest left-wing party of the six represented in the Bundestag
    (left)
-   "SPD" Social Democratic Party of Germany, center left (center).

egoposition_immigration - Ego-position toward immigration (0 = very open to 10 = very
restrictive )

ostwest - Dummy for respondents from Eastern Germany (= 1)

political_interest - Measurement for political interst (0 = low, 4 = high)

income - Self-reported income satisfaction (0 = low, 4 = high)

gender - Self-reported gender (binary coding with 1 = female)

```{r include=FALSE}

if(!is.null(dev.list())) dev.off() # Clear plots
rm(list=ls()) # Clean workspace

load("./gles.RData")

df <- gles

summary(df)
str(df)
```

# 1 - Data Preparation

## 1.1 - Removing duplicate or irrelevant observations

Since there is not a column that represents the uniqueness of every row, we can not check
if there are any duplicates

```{r include=FALSE}

idx_dup<-which(duplicated(df))
idx_dup
length(idx_dup)

#df<-unique(df)

```

## 1.2 - Fix structural errors and check data types

It seems that there are no coding errors. All factors are correctly defined.

We renamed the level factors with a meaningful names that describes the factors to which
they belong. This helps us to better understanding when create the model.

```{r include=FALSE}

intervals <- c(0,2,4,6,8,10)

df$gegopos_immi <- factor(cut(df$egoposition_immigration,breaks=intervals))
table(df$gegopos_immi)

# mediana dintre de cada grup
cintervals<- tapply(df$egoposition_immigration,df$gegopos_immi,median)

# ngincome: numeric, mediana segons el grup al que pertany
df$ngegopos_immi<-factor(cut(df$egoposition_immigration,breaks=intervals))
df$ngegopos_immi<-factor(df$ngegopos_immi,labels=cintervals)
df$ngegopos_immi<-as.numeric(levels(df$ngegopos_immi))[df$ngegopos_immi]

# Set Factors
df$vote=as.factor(df$vote)
df$egoposition_immigration=as.factor(df$egoposition_immigration)
df$ostwest=as.factor(df$ostwest)
df$political_interest=as.factor(df$political_interest)
df$income=as.factor(df$income)
df$gender=as.factor(df$gender)

# Rename levels for each factor
levels(df$vote) <- c("vote.AfD", "vote.CDU/CSU", "vote.FDP", "vote.Gruene", "vote.LINKE", "vote.SPD")
levels(df$egoposition_immigration) <- c("immgration.0", "immgration.1",
      "immgration.2", "immgration.3", "immgration.4", "immgration.5", "immgration.6", "immgration.7", "immgration.8", "immgration.9", "immgration.10")
levels(df$ostwest) <- c("ostwest.no", "ostwest.yes")
levels(df$political_interest) <- c("political_interest.low", "political_interest.low_medium","political_interest.medium", "political_interest.medium_high", "political_interest.high")
levels(df$income) <- c("income.low", "income.low_medium","income.medium", "income.medium_high", "income.high")
levels(df$gender) <- c("gender.male", "gender.female")

#Final structure
str(df)

```

## 1.3 - Filter unwanted outliers.

As all the variables are categorical, there are not outliers.

## 1.4 - Handle missing data

Neither individuals nor features has missing values.

```{r include=FALSE}
colnames(df)

# DETECTING MISSING VALUES
which(is.na(df$vote)) 
which(is.na(df$egoposition_immigration)) 
which(is.na(df$ostwest)) 
which(is.na(df$political_interest)) 
which(is.na(df$income)) 
which(is.na(df$gender)) 

# PER INDIVIDUAL
mis_ind = rowSums(is.na(df))
mis_ind
df[which(mis_ind>0),] # Show individuals with some NA value

# PER FEATURE
mis_col = colSums(is.na(df))
mis_col
df[,which(mis_col>0)] # Show features with some NA value

```

## 1.5 - Data balancing

We can observe that the dataset that we are working with it is unbalanced on its target
variable.

```{r include=FALSE}

lbls = names(table(df$vote))


pie(table(df$vote),labels = lbls, col=rainbow(length(table(df$vote))), main="Distribution of votes (Target variable)")


#(?) hem de balancejar el dataset? podem fer servir el que volguem? 


```

# 2 - Data Exploration

## 2.1 Derivation of New variables

```{r include=FALSE}

#Dimension reduction of egoposition immigration from 10 to 3.
df$egoposition_immigration_red <- df$egoposition_immigration

levels(df$egoposition_immigration_red) <- list("immigration.open" = c("immgration.0", "immgration.1", "immgration.2"), 
    "immigration.mid" = c("immgration.3", "immgration.4","immgration.5"),
    "immigration.restrictive" = c("immgration.6", "immgration.7", "immgration.8", "immgration.9", "immgration.10"))

df$egoposition_immigration_red2 <- df$egoposition_immigration

levels(df$egoposition_immigration_red2) <- list("immigration.open" = c("immgration.0", "immgration.1", "immgration.2"), 
    "immigration.open_moderate" = c("immgration.3", "immgration.4"),
    "immigration.moderate" = c("immgration.3", "immgration.5"),
    "immigration.moderate_restrictive" = c("immgration.6", "immgration.7"),  "immigration.restrictive" = c("immgration.8", "immgration.9", "immgration.10"))

# Political Orientation
df$politicalOrientation <- df$vote

levels(df$politicalOrientation) <- list("politicalOrientation.right"=c("vote.AfD"),
            "politicalOrientation.center"=c("vote.CDU/CSU", "vote.FDP","vote.SPD"),
            "politicalOrientation.left"=c("vote.Gruene", "vote.LINKE"))


```

## 2.2 - Data Analysis

-   We can observe that we have more male voters.
-   We can oberve that there is a difference in the income between genders.

```{r include=FALSE}

pie(table(df$vote),labels = names(table(df$vote)), col=rainbow(length(table(df$vote))), main="Distribution of votes (Target variable)")

myplot <- ggplot(df, aes(vote)) + 
          geom_bar(aes(y = (..count..)/sum(..count..))) + 
          scale_y_continuous(labels=scales::percent) +
  ylab("relative frequencies")

myplot

pie(table(df$egoposition_immigration),labels = names(table(df$egoposition_immigration)), col=rainbow(length(table(df$egoposition_immigration))), main="Distribution of egoposition_immigration")

pie(table(df$egoposition_immigration_red),labels = names(table(df$egoposition_immigration_red)), col=rainbow(length(table(df$egoposition_immigration))), main="Distribution of egoposition_immigration")

pie(table(df$ostwest),labels = names(table(df$ostwest)), col=rainbow(length(table(df$ostwest))), main="ostwest")

pie(table(df$political_interest),labels = names(table(df$political_interest)), col=rainbow(length(table(df$political_interest))), main="political_interest")
#we can see that political interest 0 is residual, may be we can delete it

pie(table(df$income),labels = names(table(df$income)), col=rainbow(length(table(df$income))), main="income")

pie(table(df$gender),labels = names(table(df$gender)), col=rainbow(length(table(df$gender))), main="gender")

pie(table(df$politicalOrientation),labels = names(table(df$politicalOrientation)), col=rainbow(length(table(df$politicalOrientation))), main="politicalOrientation")


colnames(df)

# barplots counts
counts <- table(df$gender, df$income)
barplot(counts, 
        xlab="Number of Income type", col=c("darkblue","red"),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topleft"))

counts <- table(df$gender, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=c("darkblue","red"),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topright"))


counts <- table(df$vote, df$income)
barplot(counts,
        xlab="Number of Votes", col=topo.colors(5),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topleft"))

counts <- table(df$ostwest, df$income)
barplot(counts, 
        xlab="Number of Votes", col=c("darkblue","red"),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topleft"))



str(df)

counts <- table(df$egoposition_immigration)
barplot(counts, 
        xlab="Number of Votes", col=c("darkblue","red"),
        beside=TRUE)

counts <- table(df$egoposition_immigration_red)
barplot(counts, 
        xlab="Number of Votes", col=c("darkblue","red"),
        beside=TRUE)


counts <- table(df$egoposition_immigration_red, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(3),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topright"))

counts <- table(df$egoposition_immigration_red, df$income)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(3),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "topleft"))

```

## 2.3 - Profiling

```{r include=FALSE}

names(df)
df$control <-0
res.cat=catdes(df, 1) 
res.cat$test.chi2
res.cat$category


counts <- table(df$politicalOrientation, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(3),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "top"))

#plots of the variables that influentiate vote usign catdes
counts <- table(df$egoposition_immigration_red, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(3),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "top"))

counts <- table(df$ostwest, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(2),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "top"))

counts <- table(df$gender, df$vote)
barplot(counts, 
        xlab="Number of Votes", col=topo.colors(2),
        legend = rownames(counts),  beside=TRUE, 
        args.legend = list(x = "top"))


#As the dataset is very unbalanced we can apply porcentual plots.
ggplot(df, aes(x= gender,  group=vote)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$gender))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Gender") +
    facet_grid(~vote) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


ggplot(df, aes(x= egoposition_immigration_red,  group=vote)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$egoposition_immigration_red))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="day") +
    facet_grid(~vote) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )

## ORIENTACIÓ POLITCA VS GEnDER
ggplot(df, aes(x= politicalOrientation,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$politicalOrientation))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


## ORIENTACIÓ POLITCA VS egoposition_immigration_red
ggplot(df, aes(x= politicalOrientation,  group=egoposition_immigration_red2)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$politicalOrientation))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="day") +
    facet_grid(~egoposition_immigration_red2) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )

ggplot(df, aes(x= ostwest,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$ostwest))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )

ggplot(df, aes(x= political_interest,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$political_interest))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


### OSTWEST FILTERS

ggplot(df[df$ostwest=='ostwest.yes',], aes(x= political_interest,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$political_interest))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Interest (ostwest.yes)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )

# Curios les noies, a OSTWEST.NO tenen interes politic mes alt
ggplot(df[df$ostwest=='ostwest.no',], aes(x= political_interest,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$political_interest))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Interest (ostwest.no)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )

# CURIOS OSTWEST.NO els vots Masculins i Femenins estan mes radicalitzats
ggplot(df[df$ostwest=='ostwest.yes',], aes(x= politicalOrientation,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$politicalOrientation))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation (ostwest.yes)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


ggplot(df[df$ostwest=='ostwest.no',], aes(x= politicalOrientation,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$politicalOrientation))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation (ostwest.no)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


############################ MIRARHO PER PARTITS POLITICS!
ggplot(df[df$ostwest=='ostwest.yes',], aes(x= vote,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$vote))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation (ostwest.yes)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


ggplot(df[df$ostwest=='ostwest.no',], aes(x= vote,  group=gender)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$vote))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation (ostwest.no)") +
    facet_grid(~gender) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


ggplot(df, aes(x= income,  group=politicalOrientation)) + 
    geom_bar(aes(y = ..prop.., fill = factor(..x..,labels=levels(df$income))), stat="count") +
    geom_text(aes( label = scales::percent(..prop..),
                   y= ..prop.. ), stat= "count", vjust = -.5) +
    labs(y = "Percent", fill="Political Orientation (ostwest.no)") +
    facet_grid(~politicalOrientation) +
    scale_y_continuous(labels = scales::percent) +
    theme(axis.text.x=element_blank(),
          axis.ticks.x=element_blank() 
    )


```


## 2.4 - MCA

```{r include=FALSE}
df
MCA(X, ncp = 5, graph = TRUE)



```



# 3 - Feature Selection

```{r include=FALSE}

```

# 4 - Modeling

## 4.1 - Modeling using numeric variables using transformations if needed.

```{r include=FALSE}
# With baseline reparametrization (To mantain the configuration)
options(contrasts=c("contr.treatment","contr.treatment"))
```

```{r}


#---------------------------------
ones<-c(rep(1, 1000))
mm0 <-multinom( politicalOrientation~1, data=df,weight=ones)
mm1 <-multinom( politicalOrientation~egoposition_immigration_red, data=df,weight=ones )
mm2 <-multinom( politicalOrientation~ostwest, data=df,weight=ones )
mm3 <-multinom( politicalOrientation~political_interest, data=df,weight=ones )
mm4 <-multinom( politicalOrientation~income, data=df,weight=ones )
mm5 <-multinom( politicalOrientation~gender, data=df,weight=ones )
mm6 <-multinom( politicalOrientation~egoposition_immigration_red2, data=df,weight=ones )
mm7 <-multinom( politicalOrientation~egoposition_immigration, data=df,weight=ones )
mm8 <-multinom( politicalOrientation~egoposition_immigration_red+gender, data=df,weight=ones )
mm9 <-multinom( vote~egoposition_immigration+political_interest+income+gender+ostwest, data=gles,weight=ones, Hess=TRUE )

mm10 <-multinom( politicalOrientation~egoposition_immigration+political_interest+income+gender+ostwest, data=df,weight=ones, Hess=TRUE )

# https://rdrr.io/cran/MNLpred/f/vignettes/OVA_Predictions_For_MNL.Rmd

AIC(mm0, mm1,mm2,mm3,mm4,mm5,mm6, mm7,mm8,mm9) # mm3 434.8819
predict(mm10,type="class")[987]
df$politicalOrientation[987]
plot(allEffects(mm7))
summary(mm9)

#ojo
pred1 <- mnl_pred_ova(model = mm9,
                      data = gles,
                      x = "egoposition_immigration",
                      by = 1,
                      seed = "random", # default
                      nsim = 100, # faster
                      probs = c(0.025, 0.975)) # default

ggplot(data = pred1$plotdata, aes(x = egoposition_immigration, 
                                  y = mean,
                                  ymin = lower, ymax = upper)) +
  geom_ribbon(alpha = 0.1) + # Confidence intervals
  geom_line() + # Mean
  facet_wrap(.~ vote, scales = "free_y", ncol = 2) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) + # % labels
  scale_x_continuous(breaks = c(0:10)) +
  theme_bw() +
  labs(y = "Predicted probabilities",
       x = "Ego-position toward immigration") # Always label your axes ;)
```

```{r}
## SPLIT

set.seed(010195)
llwork <- sample(1:nrow(gles),round(0.8*nrow(gles),dig=0))
dfwork <- gles[llwork,]
dftest <- gles[-llwork,]

mm9 <-multinom( vote~egoposition_immigration+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])), Hess=TRUE )

gles.fin <- mm9
prob.vote <- gles.fin$fit
tt <- table(predict(mm9,type="class"),dfwork$vote)
tt

(accuracy <- sum(diag(tt)) / sum(tt))
(precision <- diag(tt) / rowSums(tt))
(recall <- (diag(tt) / colSums(tt)))
(f1 <- (2*precision*recall/(precision+recall)))


# Model na?ve
m0 <-multinom( vote~1, data=dfwork,weight=c(rep(1, dim(dfwork)[1])), Hess=TRUE )
tt <- table(predict(m0,type="class"),dfwork$vote)
tt

(accuracy <- sum(diag(tt)) / sum(tt))
(precision <- diag(tt) / rowSums(tt))
(recall <- (diag(tt) / colSums(tt)))
(f1 <- (2*precision*recall/(precision+recall)))
```

```{r}

## SPLIT
llwork <- sample(1:nrow(df),round(0.8*nrow(df),dig=0))
dfwork <- df[llwork,]
dftest <- df[-llwork,]

mm9 <-multinom( vote~egoposition_immigration+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))

mm91 <-multinom( vote~egoposition_immigration_red+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))

mm91.2 <-multinom( vote~egoposition_immigration_red2+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))

mm91.1 <-multinom( vote~egoposition_immigration_red+political_interest+income+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))

AIC(mm91,mm91.2)

mm92 <-multinom( vote~egoposition_immigration_red2+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))


om0<-polr(  vote~1, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))
om1 <-polr(  vote~egoposition_immigration, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))
om2 <-polr(  vote~political_interest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))
om3 <-polr(  vote~egoposition_immigration+political_interest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))
om3.1 <-polr(  vote~gegopos_immi+political_interest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))
om4 <-polr(  vote~egoposition_immigration_red+political_interest+income+gender+ostwest, data=dfwork,weight=c(rep(1, dim(dfwork)[1])))


anova(om0,om1,test='Chisq' )
anova(om0,om2,test='Chisq' )
anova(om1,om2,test='Chisq' )
anova(om3,om2,test='Chisq' )
anova(om3,om3.1,test='Chisq' )
anova(om4,om3,test='Chisq' )

AIC(mm9,mm91,mm92,mm91.1)

checkModel<-mm91

gles.fin <- checkModel
prob.vote <- gles.fin$fit
tt <- table(predict(checkModel,type="class"),dfwork$vote)
tt

(accuracy <- sum(diag(tt)) / sum(tt))
(precision <- diag(tt) / rowSums(tt))
(recall <- (diag(tt) / colSums(tt)))
(f1 <- (2*precision*recall/(precision+recall)))
```

## 4.2 - Adding factor main effects to the best model containing numeric variables

## 4.3 - Adding factor main effects and interactions (limit your statement to order 2) to the best model containing numeric variables.

## 4.4 - Goodness of fit and Model Interpretation for each proposal (nominal/ordinal).

## 4.5 - Goodness of fit and Model Interpretation for political orientation (right/center/left). Make your own allocation of political parties to the right/center/left wing orientation.
